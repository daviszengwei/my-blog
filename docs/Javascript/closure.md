---
title: 闭包的特性
date: 2020-06-08
tags:
- javascript
categories: 
- javascript
sidebarDepth: 2
---

# JavaScript 深度剖析

## 闭包的特性
闭包就是能**访问其他函数内部变量的函数**，理解这句话可以从以下几点开始。

### 1.闭包为什么是函数？  

  解释这点需要先了解 JavaScript 语言特有的一种结构--链式作用域，即为，子对象会一级一级地向上寻找所有父对象的变量。所以，父对象的所有变量，对子对象是可见的，反之则不成立。
  
  了解这点后，可做以下推论，外部无法访问父函数的局部变量，而子函数可以访问父函数的局部变量，只要将子函数作为返回值，就可以在外部间接访问到父函数的局部变量了。

  因此可以吧闭包简单理解成<code>定义在一个函数内部的函数</code>。

  所以，在本质上，闭包就是将函数内部和函数外部连接起来的一座桥梁。

### 2.闭包的作用  

  一个是前面提到的可以读取函数内部的变量，另一个就是让这些变量的值始终保持在内存中。

  父函数将子函数作为返回值，再将子函数赋值给一个变量，所以子函数会存在于内存中，而子函数依赖于父函数存在，所以父函数也会存在于内存中，也就不会被垃圾回收机制回收。

### 3.闭包实例

  (1) 需要多个计数器?

  ```javascript
    function addCount() {
      var conut = 0;
      return function() {
        count = count + 1;
        console.log(count);
      };
    }
  ```

  这里解释一下上边的过程：<code>addCount()</code>执行的时候，**返回一个函数**，函数是可以**创建自己的作用域的**，但是此时返回的这个函数内部需要引用<code>addCount()</code>**作用域下的变量count**，因此这个<code>count</code>是不能被销毁的，接下来需要几个计数器我们就定义几个变量就可以，并且他们都不会互相影响，每个函数作用域中还会保存<code>count</code>变量不被销毁，进行不断的累加

  ```javascript
    var fun1 = addCount();
    fun1();   // 1
    fun1();   // 2
    var fun2 = addCount();
    fun2();   // 1
    fun2();   // 2
  ```

  (2) 面试题  
  for循环中打印  
  ```javascript
    for(var i = 0; i < 4; i++) {
      setTimeout(function() {
        console.log(i);
      }, 300)
    }
  ```

  *上面打印出来都是4，可能部分人会认为打印的是 0,1,2,3*

  **原因:** js执行的时候首先 **会执行主线程，异步相关的会存到异步队列里，** 当主线程执行完毕开始执行异步队列，主线程执行完毕后，此时<code>i</code>的值为4，所以在执行异步队列的时候，打印出来的都是4  

  **如何修改使其正常打印：（使用闭包使其正常打印）**

  ```javascript
    for (var i = 0; i < 4; i++) {
      (function(i){
        setTimeout( function() {
            console.log(i);
        },  1000 );
      })(i);
    }
  ```

  (3) 闭包的缺陷:  
  **闭包会导致内存占用过高，因为变量都没有释放内存**














  




